<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Search - WB L0</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        header {
            background: #2c3e50;
            color: white;
            padding: 30px;
            text-align: center;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .search-section {
            padding: 40px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }

        .search-form {
            display: flex;
            gap: 15px;
            max-width: 500px;
            margin: 0 auto;
        }

        #orderId {
            flex: 1;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            outline: none;
            transition: border-color 0.3s;
        }

        #orderId:focus {
            border-color: #3498db;
        }

        button {
            padding: 15px 30px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: background 0.3s;
        }

        button:hover {
            background: #2980b9;
        }

        .result-section {
            padding: 40px;
            min-height: 400px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .error {
            background: #ffe6e6;
            color: #d63031;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #d63031;
        }

        .order-card {
            background: white;
            border-radius: 10px;
            padding: 30px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .order-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eee;
        }

        .order-id {
            font-size: 1.5em;
            color: #2c3e50;
            font-weight: bold;
        }

        .order-date {
            color: #7f8c8d;
        }

        .section {
            margin: 25px 0;
        }

        .section-title {
            font-size: 1.2em;
            color: #3498db;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .info-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
        }

        .info-label {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .info-value {
            color: #34495e;
        }

        .items-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .item-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #3498db;
        }

        .no-data {
            text-align: center;
            color: #7f8c8d;
            font-style: italic;
            padding: 40px;
        }

        @media (max-width: 768px) {
            .search-form {
                flex-direction: column;
            }

            .grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <header>
        <h1>üîç Order Search</h1>
        <p>–ü–æ–∏—Å–∫ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∑–∞–∫–∞–∑–∞—Ö</p>
    </header>

    <div class="search-section">
        <form class="search-form" onsubmit="searchOrder(event)">
            <input
                    type="text"
                    id="orderId"
                    placeholder="–í–≤–µ–¥–∏—Ç–µ ID –∑–∞–∫–∞–∑–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: b563feb7b2b84b6test)"
                    required
            >
            <button type="submit">–ù–∞–π—Ç–∏</button>
        </form>
    </div>

    <div class="result-section" id="resultSection">
        <div class="no-data" id="noData">
            –í–≤–µ–¥–∏—Ç–µ ID –∑–∞–∫–∞–∑–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
        </div>
    </div>
</div>

<script>
    const API_BASE_URL = 'http://localhost:8080';

    async function searchOrder(event) {
        event.preventDefault();

        const orderId = document.getElementById('orderId').value.trim();
        if (!orderId) return;

        const resultSection = document.getElementById('resultSection');
        resultSection.innerHTML = `
                <div class="loading">
                    <h3>üîé –ü–æ–∏—Å–∫ –∑–∞–∫–∞–∑–∞...</h3>
                    <p>–ò—â–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–∞–∫–∞–∑–µ ${orderId}</p>
                </div>
            `;

        try {
            const response = await fetch(`${API_BASE_URL}/order/${orderId}`);

            if (!response.ok) {
                if (response.status === 404) {
                    throw new Error('–ó–∞–∫–∞–∑ –Ω–µ –Ω–∞–π–¥–µ–Ω');
                }
                throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');
            }

            const order = await response.json();
            displayOrder(order);

        } catch (error) {
            resultSection.innerHTML = `
                    <div class="error">
                        <h3>‚ùå –û—à–∏–±–∫–∞</h3>
                        <p>${error.message}</p>
                        <p>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ ID –∑–∞–∫–∞–∑–∞ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞</p>
                    </div>
                `;
        }
    }

    function displayOrder(order) {
        const resultSection = document.getElementById('resultSection');

        resultSection.innerHTML = `
                <div class="order-card">
                    <div class="order-header">
                        <div>
                            <div class="order-id">–ó–∞–∫–∞–∑ #${order.order_uid}</div>
                            <div class="order-date">–°–æ–∑–¥–∞–Ω: ${new Date(order.date_created).toLocaleString('ru-RU')}</div>
                        </div>
                        <div class="track-number">–¢—Ä–µ–∫: ${order.track_number}</div>
                    </div>

                    <div class="grid">
                        <div class="info-item">
                            <div class="info-label">–ö–ª–∏–µ–Ω—Ç</div>
                            <div class="info-value">${order.customer_id}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">–°–ª—É–∂–±–∞ –¥–æ—Å—Ç–∞–≤–∫–∏</div>
                            <div class="info-value">${order.delivery_service}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">–õ–æ–∫–∞–ª—å</div>
                            <div class="info-value">${order.locale}</div>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">üì¶ –î–æ—Å—Ç–∞–≤–∫–∞</div>
                        <div class="grid">
                            ${Object.entries(order.delivery).map(([key, value]) => `
                                <div class="info-item">
                                    <div class="info-label">${formatLabel(key)}</div>
                                    <div class="info-value">${value || '‚Äî'}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">üí≥ –û–ø–ª–∞—Ç–∞</div>
                        <div class="grid">
                            ${Object.entries(order.payment).map(([key, value]) => `
                                <div class="info-item">
                                    <div class="info-label">${formatLabel(key)}</div>
                                    <div class="info-value">${formatPaymentValue(key, value)}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-title">üõçÔ∏è –¢–æ–≤–∞—Ä—ã (${order.items.length})</div>
                        <div class="items-grid">
                            ${order.items.map(item => `
                                <div class="item-card">
                                    <div class="info-label">${item.name}</div>
                                    <div class="info-value">–ë—Ä–µ–Ω–¥: ${item.brand}</div>
                                    <div class="info-value">–¶–µ–Ω–∞: $${item.price}</div>
                                    <div class="info-value">–°–∫–∏–¥–∫–∞: ${item.sale}%</div>
                                    <div class="info-value">–°—Ç–∞—Ç—É—Å: ${item.status}</div>
                                    <div class="info-value">–ê—Ä—Ç–∏–∫—É–ª: ${item.chrt_id}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
    }

    function formatLabel(key) {
        const labels = {
            'name': '–ò–º—è',
            'phone': '–¢–µ–ª–µ—Ñ–æ–Ω',
            'zip': '–ò–Ω–¥–µ–∫—Å',
            'city': '–ì–æ—Ä–æ–¥',
            'address': '–ê–¥—Ä–µ—Å',
            'region': '–†–µ–≥–∏–æ–Ω',
            'email': 'Email',
            'transaction': '–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è',
            'currency': '–í–∞–ª—é—Ç–∞',
            'provider': '–ü—Ä–æ–≤–∞–π–¥–µ—Ä',
            'amount': '–°—É–º–º–∞',
            'payment_dt': '–î–∞—Ç–∞ –æ–ø–ª–∞—Ç—ã',
            'bank': '–ë–∞–Ω–∫',
            'delivery_cost': '–°—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏',
            'goods_total': '–°—É–º–º–∞ —Ç–æ–≤–∞—Ä–æ–≤',
            'custom_fee': '–ö–æ–º–∏—Å—Å–∏—è'
        };
        return labels[key] || key;
    }

    function formatPaymentValue(key, value) {
        if (key === 'payment_dt' && value) {
            return new Date(value * 1000).toLocaleString('ru-RU');
        }
        if (key === 'amount' || key === 'delivery_cost' || key === 'goods_total') {
            return `$${value}`;
        }
        return value || '‚Äî';
    }

    // –ê–≤—Ç–æ—Ñ–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞
    document.getElementById('orderId').focus();
</script>
</body>
</html>